import React, { useState } from 'react';
import { Link,useHistory } from 'react-router-dom';
import Warning from './Warning';
import Popup from './Popup';

const ResetPasswordForm = () => {
  const [passwordVis, setPasswordVis] = useState('password');
  const [isVisible, setIsVisible] = useState(true);
  const history = useHistory();
  const [Email, setEmail] = useState("");
  const [isOpen,setIsOpen] = useState('');

  const [message, setMessage] = useState('');

  const resetPassword = () => {
    fetch('/api/resetPassword', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({Email}),
    })
      .then((response) => response.json())
      .then((json) => {
        setMessage(json);
        if (json.correct) {
          setIsOpen(false)
          setEmail("");
        }else {
          setIsOpen(true)
        }
      });
  };
  const changePassType = (e) => {
    if (e.keyCode === 9) {
      return;
    }

    if (passwordVis === 'password') {
      setPasswordVis('text');
      setIsVisible(false);
    } else {
      setPasswordVis('password');
      setIsVisible(true);
    }
  };

  if(message.correct){
    setTimeout(() => {
      history.push("/login")
    },2000)
  }


  return (
    <>
    
      <div class="popup-relative">
      <main className="main__reset" style={message.correct ? {filter: 'blur(3px)'} : {filter: 'blur(0px)'}}>
      <div style={{ marginTop: '2rem',width: '100%' }} className="link__back">
        <Link style={{ margin: '2rem' }} to="/login">
          <svg
            width="40"
            height="40"
            viewBox="0 0 49 49"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle
              cx="24.0475"
              cy="24.0475"
              r="23.0475"
              stroke="#4A5568"
              strokeWidth="2"
            />
            <path
              fillRule="evenodd"
              clipRule="evenodd"
              d="M15.344 25.55L24.56 33.4523L23.202 35L11 24.5L23.224 14L24.556 15.5813L15.348 23.45H39V25.55H15.344Z"
              fill="#4A5568"
            />
          </svg>
        </Link>
      </div>
        <h2 className="heading-2" style={{color: '#1db95e', marginTop: '4rem'}}>Forgot password?</h2>
        <form className="section__formWrapper" name="reset password form" style={{display: 'inline-block',marginTop: '4rem'}}>
          <label className="passwordForm__email form__label">
            <p className="label__paragraph" style={{textAlign: 'left'}}>E-mail: </p>
            <input
              className="label__input label__input--email"
              type="email"
              name="Email"
              placeholder="Your E-mail"
              required
              value={Email}
              onChange={(e) => setEmail(e.target.value)}
            />
          </label>
        </form>
      
      
      <div style={{margin: '10rem'}}>
      <svg width="284" height="198" viewBox="0 0 284 198" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0)">
<path d="M56.5851 198C87.8362 198 113.17 196.072 113.17 193.694C113.17 191.315 87.8362 189.387 56.5851 189.387C25.334 189.387 0 191.315 0 193.694C0 196.072 25.334 198 56.5851 198Z" fill="#E6E6E6"/>
<path d="M43.2527 43.9327C53.1002 39.7356 65.3654 42.3948 77.3438 44.2404C77.4552 42.0054 78.8063 39.2852 77.391 37.7259C75.6716 35.8315 75.8299 33.841 76.8646 31.8391C79.5104 26.7198 75.7196 21.2726 71.8921 16.7433C71.0294 15.7248 69.9391 14.9244 68.7098 14.4074C67.4805 13.8904 66.1468 13.6712 64.8171 13.7677L57.7269 14.2751C56.0016 14.3986 54.3551 15.0472 53.0076 16.134C51.6602 17.2208 50.6761 18.694 50.1871 20.3566V20.3566C48.4941 22.6638 47.588 24.9647 48.1585 27.2536C45.6227 28.9901 45.1967 31.0862 46.3362 33.4493C47.3024 34.9371 47.2921 36.3854 46.2922 37.7936C44.979 39.5889 43.9732 41.5908 43.3161 43.7171L43.2527 43.9327Z" fill="#2F2E41"/>
<path d="M277.27 171.168H76.5658C74.781 171.168 73.0692 170.457 71.8072 169.193C70.5451 167.928 69.8361 166.213 69.8361 164.424C142.591 155.951 213.979 155.951 284 164.424C284 166.213 283.291 167.928 282.029 169.193C280.767 170.457 279.055 171.168 277.27 171.168Z" fill="#2F2E41"/>
<path d="M284 164.821L69.8361 164.424L94.6569 122.574L94.7757 122.376V30.1438C94.7756 29.0243 94.9956 27.9158 95.4231 26.8815C95.8505 25.8471 96.4772 24.9074 97.2672 24.1158C98.0571 23.3241 98.995 22.6962 100.027 22.2679C101.059 21.8395 102.166 21.619 103.283 21.6191H249.366C250.483 21.619 251.589 21.8395 252.621 22.2679C253.653 22.6962 254.591 23.3241 255.381 24.1158C256.171 24.9074 256.798 25.8471 257.225 26.8815C257.653 27.9158 257.873 29.0243 257.873 30.1438V123.011L284 164.821Z" fill="#3F3D56"/>
<path d="M103.089 27.5693C102.354 27.5702 101.65 27.863 101.13 28.3835C100.611 28.9041 100.319 29.6099 100.318 30.3461V114.442C100.319 115.179 100.611 115.884 101.13 116.405C101.65 116.926 102.354 117.218 103.089 117.219H250.747C251.482 117.218 252.186 116.925 252.706 116.405C253.225 115.884 253.517 115.179 253.518 114.442V30.3461C253.517 29.6099 253.225 28.9041 252.706 28.3836C252.186 27.863 251.482 27.5702 250.747 27.5693H103.089Z" fill="white"/>
<path d="M103.708 128.326C103.481 128.327 103.258 128.392 103.067 128.515C102.876 128.638 102.724 128.812 102.629 129.019L94.9806 145.68C94.8973 145.861 94.8609 146.06 94.8747 146.259C94.8884 146.458 94.952 146.651 95.0594 146.819C95.1669 146.987 95.3147 147.125 95.4895 147.221C95.6642 147.317 95.8602 147.367 96.0593 147.367H256.894C257.097 147.367 257.296 147.315 257.473 147.216C257.649 147.118 257.798 146.975 257.904 146.803C258.011 146.63 258.072 146.433 258.081 146.23C258.09 146.028 258.047 145.826 257.956 145.645L249.643 128.984C249.545 128.786 249.394 128.619 249.206 128.503C249.018 128.387 248.802 128.326 248.581 128.326H103.708Z" fill="#2F2E41"/>
<path d="M176.324 26.181C177.308 26.181 178.106 25.3818 178.106 24.3959C178.106 23.41 177.308 22.6108 176.324 22.6108C175.34 22.6108 174.543 23.41 174.543 24.3959C174.543 25.3818 175.34 26.181 176.324 26.181Z" fill="white"/>
<path d="M160.516 150.54C160.254 150.541 160.001 150.627 159.794 150.786C159.586 150.945 159.437 151.168 159.369 151.421L157.45 158.561C157.403 158.738 157.397 158.923 157.432 159.102C157.467 159.281 157.544 159.45 157.654 159.595C157.765 159.74 157.908 159.857 158.071 159.938C158.235 160.019 158.415 160.061 158.597 160.061H195.082C195.271 160.061 195.457 160.015 195.626 159.928C195.794 159.842 195.939 159.715 196.049 159.561C196.159 159.406 196.23 159.228 196.257 159.04C196.284 158.852 196.265 158.661 196.203 158.481L193.737 151.341C193.656 151.107 193.505 150.905 193.304 150.761C193.102 150.618 192.862 150.54 192.615 150.54H160.516Z" fill="#2F2E41"/>
<path d="M257.873 120.988V122.574H94.6569L94.7797 122.376V120.988H257.873Z" fill="#2F2E41"/>
<path d="M253.32 55.5353C268.624 55.5353 281.031 43.1033 281.031 27.7677C281.031 12.432 268.624 0 253.32 0C238.016 0 225.61 12.432 225.61 27.7677C225.61 43.1033 238.016 55.5353 253.32 55.5353Z" fill="#1DB95E"/>
<path d="M264.8 39.8664H241.84C241.42 39.866 241.018 39.6987 240.721 39.4012C240.424 39.1038 240.257 38.7004 240.257 38.2797V24.3959C240.257 23.9752 240.424 23.5718 240.721 23.2744C241.018 22.9769 241.42 22.8096 241.84 22.8091H264.8C265.22 22.8096 265.623 22.9769 265.92 23.2744C266.217 23.5718 266.383 23.9752 266.384 24.3959V38.2797C266.384 38.7004 266.217 39.1037 265.92 39.4012C265.623 39.6987 265.22 39.866 264.8 39.8664ZM241.84 24.3959V38.2797H264.802L264.8 24.3959L241.84 24.3959Z" fill="white"/>
<path d="M260.446 24.3959H246.195V18.049C246.195 13.4519 249.192 10.1154 253.32 10.1154C257.449 10.1154 260.446 13.4519 260.446 18.049L260.446 24.3959ZM247.778 22.8092H258.862V18.049C258.862 14.3121 256.584 11.7021 253.32 11.7021C250.057 11.7021 247.778 14.3121 247.778 18.049L247.778 22.8092Z" fill="white"/>
<path d="M253.32 32.5278C254.195 32.5278 254.904 31.8174 254.904 30.9411C254.904 30.0648 254.195 29.3544 253.32 29.3544C252.446 29.3544 251.737 30.0648 251.737 30.9411C251.737 31.8174 252.446 32.5278 253.32 32.5278Z" fill="white"/>
<path d="M233.976 88.6946H119.86C119.3 88.6939 118.763 88.4706 118.367 88.0736C117.97 87.6766 117.748 87.1384 117.747 86.577V58.2115C117.748 57.6501 117.97 57.1119 118.367 56.7149C118.763 56.3179 119.3 56.0946 119.86 56.0939H233.976C234.536 56.0946 235.073 56.3179 235.469 56.7149C235.866 57.1119 236.088 57.6501 236.089 58.2115V86.577C236.088 87.1384 235.866 87.6766 235.469 88.0736C235.073 88.4706 234.536 88.6939 233.976 88.6946V88.6946ZM119.86 56.941C119.524 56.9413 119.202 57.0753 118.964 57.3135C118.726 57.5517 118.593 57.8747 118.592 58.2115V86.577C118.593 86.9138 118.726 87.2368 118.964 87.475C119.202 87.7132 119.524 87.8472 119.86 87.8475H233.976C234.312 87.8472 234.634 87.7132 234.872 87.475C235.11 87.2368 235.243 86.9138 235.244 86.577V58.2115C235.243 57.8747 235.11 57.5517 234.872 57.3135C234.634 57.0753 234.312 56.9413 233.976 56.941L119.86 56.941Z" fill="#E6E6E6"/>
<path d="M137.591 79.9319C142.346 79.9319 146.2 76.0699 146.2 71.3059C146.2 66.5419 142.346 62.6799 137.591 62.6799C132.837 62.6799 128.983 66.5419 128.983 71.3059C128.983 76.0699 132.837 79.9319 137.591 79.9319Z" fill="#E6E6E6"/>
<path d="M157.472 65.5552C157.284 65.5549 157.097 65.5919 156.923 65.664C156.748 65.7361 156.59 65.842 156.456 65.9755C156.323 66.109 156.217 66.2676 156.145 66.4422C156.073 66.6168 156.035 66.8039 156.035 66.9929C156.035 67.1819 156.073 67.369 156.145 67.5436C156.217 67.7182 156.323 67.8768 156.456 68.0103C156.59 68.1438 156.748 68.2497 156.923 68.3218C157.097 68.3939 157.284 68.4309 157.472 68.4306H225.109C225.489 68.4306 225.854 68.2791 226.123 68.0095C226.392 67.7399 226.543 67.3742 226.543 66.9929C226.543 66.6116 226.392 66.2459 226.123 65.9763C225.854 65.7067 225.489 65.5552 225.109 65.5552H157.472Z" fill="#E6E6E6"/>
<path d="M157.472 74.1812C157.092 74.1812 156.727 74.3326 156.458 74.6022C156.189 74.8718 156.038 75.2375 156.038 75.6188C156.038 76.0001 156.189 76.3658 156.458 76.6354C156.727 76.905 157.092 77.0565 157.472 77.0565H186.577C186.957 77.0565 187.322 76.905 187.591 76.6354C187.86 76.3658 188.011 76.0001 188.011 75.6188C188.011 75.2375 187.86 74.8718 187.591 74.6022C187.322 74.3326 186.957 74.1812 186.577 74.1812H157.472Z" fill="#E6E6E6"/>
<path d="M94.3761 74.7627L73.2809 86.001L73.0139 76.6358C79.8992 75.484 86.4499 73.4787 92.5069 70.214L94.7132 64.7519C94.9536 64.1567 95.3443 63.6345 95.847 63.2363C96.3497 62.8382 96.9471 62.5778 97.5805 62.4809C98.214 62.384 98.8616 62.4538 99.46 62.6834C100.058 62.9131 100.587 63.2948 100.994 63.7909V63.7909C101.589 64.5168 101.886 65.4423 101.826 66.3797C101.765 67.3172 101.352 68.1966 100.668 68.8398L94.3761 74.7627Z" fill="#FFB8B8"/>
<path d="M42.8321 139.648C42.6782 139.083 42.6456 138.491 42.7363 137.912C42.827 137.333 43.039 136.779 43.3583 136.288L47.9924 129.162C49.0884 127.476 50.7702 126.259 52.7115 125.745C54.6527 125.232 56.715 125.46 58.4982 126.384V126.384C56.5507 129.706 56.8222 132.62 59.1708 135.153C55.5248 136.936 52.1551 139.238 49.166 141.987C48.6203 142.36 47.9936 142.597 47.3381 142.678C46.6826 142.759 46.0174 142.682 45.3977 142.453C44.778 142.224 44.2219 141.85 43.7756 141.362C43.3293 140.874 43.0059 140.287 42.8321 139.648V139.648Z" fill="#2F2E41"/>
<path d="M95.3369 130.33C94.6357 131.501 93.6459 132.472 92.4624 133.15C91.2789 133.827 89.9415 134.188 88.5786 134.199L57.7934 134.432L56.4583 126.673L70.0766 122.659L58.5945 113.829L71.1447 99.1122L93.9399 120.402C95.2723 121.646 96.1379 123.311 96.3922 125.118C96.6465 126.926 96.274 128.765 95.3369 130.33V130.33Z" fill="#2F2E41"/>
<path d="M52.9868 183.399H45.777C39.3037 138.936 32.7145 94.3482 52.1857 77.7061L75.15 81.4522L72.2127 100.985L59.3954 115.702L52.9868 183.399Z" fill="#2F2E41"/>
<path d="M59.3246 193.471C58.7602 193.625 58.1696 193.658 57.5916 193.567C57.0137 193.476 56.4615 193.264 55.9713 192.944L48.143 191.89C46.4609 190.791 45.2458 189.106 44.7335 187.161C44.2212 185.216 44.4483 183.149 45.3707 181.362C48.6859 183.314 51.594 183.041 54.1212 180.688C55.9068 184.301 58.8489 184.08 61.6587 187.124C62.0307 187.671 62.267 188.299 62.3478 188.956C62.4286 189.613 62.3516 190.279 62.1233 190.9C61.8949 191.521 61.5218 192.078 61.0349 192.526C60.5481 192.973 59.9617 193.297 59.3246 193.471V193.471Z" fill="#2F2E41"/>
<path d="M70.0766 48.0051L56.7252 44.7942C58.9427 40.2459 59.1253 35.185 58.0603 29.8099L67.1393 29.5423C67.4238 36.2264 68.2844 42.471 70.0766 48.0051Z" fill="#FFB8B8"/>
<path d="M73.746 89.5088C64.0267 96.1454 57.1593 89.7359 51.9187 79.8468C52.6469 73.7955 51.4678 66.554 49.284 58.6855C48.3128 55.2149 48.6754 51.5056 50.3002 48.2899C51.925 45.0741 54.6939 42.5856 58.0603 41.3157V41.3157L69.5425 46.1321C79.2922 54.0956 81.2112 62.7216 77.5533 71.8195L73.746 89.5088Z" fill="#1DB95E"/>
<path d="M45.777 54.6945L35.0959 60.3136L54.0549 71.5518L56.6929 78.0723C56.8689 78.5075 56.9547 78.9741 56.945 79.4436C56.9352 79.9131 56.8301 80.3757 56.6361 80.8032C56.4421 81.2307 56.1633 81.6141 55.8166 81.9301C55.4699 82.2461 55.0626 82.488 54.6195 82.6411V82.6411C54.1159 82.8151 53.5789 82.8699 53.0506 82.8013C52.5223 82.7326 52.017 82.5423 51.5744 82.2453C51.1317 81.9483 50.7636 81.5527 50.499 81.0894C50.2344 80.626 50.0805 80.1076 50.0492 79.5747L49.7824 75.0303L25.6858 67.0621C24.8739 66.7936 24.1337 66.3435 23.5211 65.7459C22.9085 65.1483 22.4397 64.4189 22.1501 63.6128V63.6128C21.728 62.4379 21.7065 61.1559 22.089 59.9674C22.4715 58.7789 23.2364 57.751 24.264 57.0446L43.6408 43.7239L45.777 54.6945Z" fill="#FFB8B8"/>
<path d="M56.4582 55.7648C52.0035 53.8086 47.9527 55.9336 42.8398 57.6378L42.0387 43.4563C47.1156 40.7448 51.9562 40.0137 56.4582 42.1184L56.4582 55.7648Z" fill="#1DB95E"/>
<path d="M61.787 36.567C66.4949 36.567 70.3114 32.7426 70.3114 28.0251C70.3114 23.3075 66.4949 19.4832 61.787 19.4832C57.0792 19.4832 53.2627 23.3075 53.2627 28.0251C53.2627 32.7426 57.0792 36.567 61.787 36.567Z" fill="#FFB8B8"/>
<path d="M71.9849 26.9473C63.545 27.7756 57.1139 26.3925 53.0038 22.4542V19.2827H71.2686L71.9849 26.9473Z" fill="#2F2E41"/>
</g>
<defs>
<clipPath id="clip0">
<rect width="284" height="198" fill="white"/>
</clipPath>
</defs>
</svg>

      </div>
        <section  style={{marginTop: '1rem'}} className="section__buttons">
          <button onClick={resetPassword} className=" btn__main--full">
            Send Password Reset
          </button>
        </section>
      </main>
      {isOpen && <Warning setIsOpen={setIsOpen} isOpen={isOpen} errorMessage={message.message}/>}
      {message.correct && <Popup title="We have sent mail with reset link" message="You will be redirect in few seconds" size="2rem" iconLink={<Link to="/login">
          <div className="container__popup__svg"
          >
           <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M0 3v18h24v-18h-24zm21.518 2l-9.518 7.713-9.518-7.713h19.036zm-19.518 14v-11.817l10 8.104 10-8.104v11.817h-20z"/></svg>
          </div>
        </Link>}/>}
      </div>
    </>
  );
};

export default ResetPasswordForm;
